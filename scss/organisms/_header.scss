// CORE
// ===============================================
@use 'sass:map';
@use '../abstracts/index' as *;
// ===============================================

// ORG: header (unified — all themes)
// ===============================================
// Mixin: org-header($theme)
// Supported themes: syx | codymer | coral | forest | midnight
//
// ┌──────────────────────────────────────────────────────┐
// │  HOW THEME VARIATION WORKS — 3 methods               │
// │                                                      │
// │  METHOD 1 · CSS Custom Properties (var)              │
// │  → Values that differ per theme but all themes       │
// │    have one. Define the generic token here,          │
// │    each _theme.scss overrides the value.             │
// │    USE FOR: colors, spacing, icons, shadows.         │
// │                                                      │
// │  METHOD 2 · Sass Map / theme-cfg()                   │
// │  → Compile-time Sass values stored in               │
// │    abstracts/_theme-config.scss. Resolved at         │
// │    build time, not at runtime.                       │
// │    USE FOR: structural layout (left/right),          │
// │    Sass-only sizes, boolean flags.                   │
// │                                                      │
// │  METHOD 3 · @if $theme                               │
// │  → Direct style override for 1–2 themes only.        │
// │    No token, no map needed.                          │
// │    USE FOR: one-off rules that only one theme        │
// │    needs and would pollute the token layer.          │
// │                                                      │
// │  RULE: if ALL themes need a value → Method 1         │
// │        if a value is reused in multiple spots → M2   │
// │        if only 1-2 themes need it → Method 3         │
// └──────────────────────────────────────────────────────┘
// ===============================================

@mixin org-header($theme: null) {
  .org-header {

    // ─── BASE — common to ALL themes ─────────────────────────────
    @include position(sticky, 0, null, null, null);
    @include padding(var(--component-header-padding-y) null);
    z-index: var(--component-header-z-index);

    // ─── METHOD 1 · CSS Custom Property ──────────────────────────
    // All themes have a background color but each one differs.
    // The token --component-header-bg is defined generically here;
    // each theme's _theme.scss overrides it with its own value.
    // Default fallback in abstracts/tokens/components/_headers.scss → transparent.
    background-color: var(--component-header-bg);

    // ─── METHOD 3 · @if — border-bottom only for codymer ─────────
    // This border-bottom is exclusive to Codymer. Adding a token for it
    // just to serve one theme would pollute the token layer unnecessarily.
    @if $theme == 'codymer' {
      border-bottom: 1px solid var(--component-header-border-color, var(--semantic-color-border-subtle));
    }

    // ─── METHOD 3 · @if — backdrop blur only for midnight ────────
    // Midnight is a dark glass-morphism theme; blur makes sense only there.
    @if $theme == 'midnight' {
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    // &__sidenav ──────────────────────────────────────────────────
    &__sidenav {
      // BASE
      @include size(var(--component-sidenav-width), 100%);
      z-index: var(--component-sidenav-z-index);
      overflow-x: hidden;
      @include transition(transform 0.5s ease);

      // METHOD 1 · tokens
      background-color: var(--component-sidenav-bg);
      box-shadow: var(--component-sidenav-shadow);

      // ─── METHOD 2 · Sass Map — sidenav side ────────────────────
      // Codymer's sidenav opens from the right (brand identity).
      // The value lives in $theme-config so any future mixin that
      // needs to know which side can also call theme-cfg().
      @if theme-cfg($theme, 'header-sidenav-side', left) == right {
        @include position(fixed, 0, 0, null, null);
        transform: translateX(100%);
      } @else {
        @include position(fixed, 0, null, null, 0);
        transform: translateX(-100%);
      }

      &.is-open {
        transform: translateX(0);
      }
    }

    // &__header ───────────────────────────────────────────────────
    &__header {
      min-height: var(--component-header-height);
      flex-basis: 100%;
    }

    // &__content ──────────────────────────────────────────────────
    &__content {
      @include padding(var(--semantic-space-inset-md));
      flex-basis: 100%;
    }

    // &__footer ───────────────────────────────────────────────────
    &__footer {
      @include padding(var(--semantic-space-inset-md));
      flex-basis: 100%;
      align-self: flex-end;
    }

    // &__logo ─────────────────────────────────────────────────────
    &__logo {
      // BASE
      @include position(relative);
      @include transition(color 0.25s ease-out);

      // METHOD 1 · token — padding driven by theme
      @include padding(null null null var(--component-header-logo-padding-left));
      color: var(--component-header-logo-color);

      @include min-screen(768px) {
        @include padding(null null null var(--component-header-logo-padding-left-md));
      }

      // :before — logo icon
      &:before {
        content: '';
        @include position(absolute, 0, null, 0, 0);
        margin: auto 0;
        @include transition(all 0.25s ease-out);

        // ─── METHOD 1 · CSS token — logo SVG per theme ───────────
        // Each _theme.scss defines --component-header-logo-icon
        // pointing to its own inline SVG or external asset.
        // example-02/_theme.scss → --component-header-logo-icon: var(--icon-logo-codymer)
        // example-03/_theme.scss → --component-header-logo-icon: var(--icon-logo-coral)
        @include background-setup(
          var(--component-header-logo-icon),
          '0 0 / contain',
          no-repeat
        );
        filter: var(--filter-primary);

        // ─── METHOD 2 · Sass Map — logo size per theme ───────────
        // Size is a Sass value (not a CSS variable) because it may
        // differ at compile time and we want type safety.
        // theme-cfg() reads from abstracts/_theme-config.scss.
        // If no override → falls back to the CSS token.
        $logo-size: theme-cfg($theme, 'header-logo-size', null);
        @if $logo-size {
          width:  $logo-size;
          height: $logo-size;
        } @else {
          @include size(var(--component-header-logo-icon-size));
        }

        @include min-screen(768px) {
          $logo-size-md: theme-cfg($theme, 'header-logo-size-md', null);
          @if $logo-size-md {
            width:  $logo-size-md;
            height: $logo-size-md;
          } @else {
            @include size(var(--component-header-logo-icon-size-md));
          }
        }
      }

      &:hover        { color: var(--component-header-logo-color-hover); }
      &:focus-visible {
        outline: var(--semantic-border-width-focus) solid var(--semantic-color-state-focus);
      }
    }

    // &__nav ──────────────────────────────────────────────────────
    &__nav {
      margin-left: auto;
    }

    // &-nav (Sidenav Menu) ────────────────────────────────────────
    &-nav {
      margin: 0;
      padding: 0;
      list-style: none;

      &__item {
        margin-bottom: 0.5rem;
      }

      &__link {
        @include position(relative);
        @include padding(
          var(--component-sidenav-link-padding-y)
          var(--component-sidenav-link-padding-x)
          var(--component-sidenav-link-padding-y)
          0
        );
        width: 100%;
        display: block;
        font-weight: var(--component-sidenav-link-font-weight);

        &:before {
          content: '';
          @include position(absolute, 0, 0, 0, null);
          margin: auto 0;
          @include size(var(--component-sidenav-link-arrow-size));
          @include background-setup(
            var(--icon-arrow-default),
            'center / contain',
            no-repeat
          );
          filter: var(--filter-color-white);
        }

        &:hover { text-decoration: underline; }

        &:focus-visible {
          outline: var(--semantic-border-width-focus) solid var(--semantic-color-state-focus);
        }
      }

      &__lvl2 {
        @include margin(0.7rem null 1rem null);
        @include padding(null null null 0.5rem);
      }
    }

    // &-rrss (Social icons) ───────────────────────────────────────
    &-rrss {
      @include margin(var(--component-header-social-gap) null);
      padding: 0;
      gap: var(--component-header-social-gap);
      display: flex;

      .helper-icon {
        @include size(var(--component-header-social-icon-size));
        @include flex-center();

        &:before {
          @include size(calc(var(--component-header-social-icon-size) * 0.8));
          filter: var(--filter-color-white);
        }
      }

      &__link {
        @include position(relative);
        @include size(var(--component-header-social-icon-size));
        display: block;

        &:focus-visible {
          outline: var(--semantic-border-width-focus) solid var(--semantic-color-state-focus);
        }
      }
    }

    // &__close ────────────────────────────────────────────────────
    &__close {
      @include position(
        absolute,
        var(--semantic-space-inset-md),
        var(--semantic-space-inset-md),
        null,
        null
      );

      .syx-btn {
        &:not(:hover) {
          background-color: transparent;
          .syx-icon:before {
            filter: var(--filter-color-white);
          }
        }
      }
    }

  } // end .org-header
}
